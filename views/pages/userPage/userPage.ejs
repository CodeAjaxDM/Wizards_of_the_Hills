<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="">
  <meta name="userPage" content="">
  <link rel="icon" href="../../favicon.ico">

  <title>User Page</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css" />
  <!-- Custom styles for this template -->
  <link href="../../stylesheets/userPages.css" rel="stylesheet">
  <script src="userPages.js"></script>

</head>

<body>
  <%- include('../../header.ejs') %>
    <div class="container">

      <!-- Header -->
      <div class="nav-spacer"></div>

      <% if (user && user.isAdminUser()) { %>
        <div class="text-center">
          <a href="/pages/userPage/adminPage">Show Admin Page</a>
        </div>
        <% } %>

          <h2> Welcome to your User Page</h2>
          <div class="text-center">
            <a href="/pages/userPage/creatorPage">
              <h4>My Content Creator Page </h4>
            </a>
          </div>
          <div class="divider"></div>

          <section class="content-section">
            <h2 class="text-center">My Published Content</h2>
            <% if (publishedItems && publishedItems.length> 0) { %>
              <div class="row content-viewer">
                <% publishedItems.forEach((item, index)=> { %>
                  <% if (item.ownedByAuthor) { %>
                    <div class="col-sm-3">
                      <div class="thumbnail">
                        <a href="/item/<%= item.itemNumber %>" class="thumbnail-link">
                          <div class="image-wrapper">
                            <img src="<%= item.imageUrl || '/images/default-image.jpg' %>" alt="<%= item.name %>"
                              class="item-image">
                          </div>
                        </a>
                        <div class="caption">
                          <h3 class="item-title">
                            <%= item.name %>
                          </h3>
                          <p class="item-price">
                            <%= item.price===0 ? 'FREE' : '$' + item.price %>
                          </p>
                          <div class="content-actions">
                            <button class="btn btn-primary content-download"
                              data-item-number="<%= item.itemNumber %>">Download</button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <% if ((index + 1) % 4===0) { %>
              </div>
              <div class="row content-viewer">
                <% } %>
                  <% } %>
                    <% }); %>
              </div>
              <% } else { %>
                <h4 class="text-center">No published items yet.</h4>
                <% } %>
          </section>

          <div class="divider"></div>
    </div>
    <%- include('../../footer.ejs') %>


      <!-- Bootstrap core JavaScript
    ================================================== -->
      <!-- Placed at the end of the document so the pages load faster -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
      <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
      <script src="/js/bootstrap.min.js"></script>
      <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
      <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>
</body>

<script>
  window.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.content-download').forEach(button => {
      button.addEventListener('click', function (event) {
        const itemNumber = event.target.getAttribute('data-item-number');
        // Initiate download by sending a POST request
        fetch('/downloadItem', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ itemNumber: itemNumber })
        })
          .then(response => {
            if (response.ok) {
              // Handle successful download
              // For example: show a success message or initiate download
            } else {
              // Handle error
              console.error('Error initiating download:', response.statusText);
            }
          })
          .catch(error => {
            console.error('Fetch error:', error);
          });
      });
    });
  });
</script>

</html>