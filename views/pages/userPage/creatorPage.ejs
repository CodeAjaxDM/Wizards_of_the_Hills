<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="description" content="">
  <meta name="creator" content="">
  <link rel="icon" href="../../favicon.ico">

  <title>Creator Page</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css" />
  <!-- Custom styles for this template -->
  <link href="../../stylesheets/userPages.css" rel="stylesheet">
  <script src="userPages.js"></script>

</head>

<body>
  <%- include('../../header.ejs') %>

  <div class="container">

  <div class="nav-spacer"></div>

  <% if (user && user.isAdminUser()) { %>
    <div class="text-center">
      <a href="/pages/userPage/adminPage">Show Admin Page</a>
    </div>
  <% } %>

    <h2> Welcome to your Content Creator</h2>
    <div class="text-center">
      <a href="/pages/userPage/userPage">
        <h4>My User Page </h4>
      </a>
    </div>
    <div class="divider"></div>

  <!-- Edit Author Name Section -->
<section class="content-section">
  <% if (msg) { %>
    <div class="alert alert-<%= msg === 'Successfully updated' ? 'success' : 'danger' %>" id="alertMsg">
      <%= msg %>
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
  <% } %>
  <div class="row">
    <div class="col-sm-6 col-sm-offset-3">
      <!-- Add the link next to the author name input field -->
      <a href="/pages/userPage/authorPage" class="btn btn-link">View/Edit My Author Page</a>
      <form id="editAuthorForm" action="/updateAuthorName" method="post">
        <div class="form-group">
          <label for="authorName">Author Name:</label>
          <input type="text" class="form-control author-input" id="authorName" name="authorName" value="<%= authorName %>" readonly>
        </div>
        <button type="button" id="editBtn" class="btn btn-primary">Edit</button>
        <button type="submit" id="submitBtn" class="btn btn-success" style="display: none;">Submit</button>
      </form>
    </div>
  </div>
</section>

<!-- Published Content Section -->
<section class="content-section">
  <h2 class="text-center">Published Content</h2>
  <% if (authorName) { %>
    <div class="text-right">
      <a href="/pages/userPage/EditCreation?imagePath=/images/author-img.jpg&title=&description=&price=" class="btn btn-primary btn-lg">Create New Item</a>
    </div>
  <% } %>
  <% if (authorName && publishedItems && publishedItems.length > 0) { %>
    <div class="row content-viewer">
      <% publishedItems.forEach((item, index) => { %>
        <% if (item.ownedByAuthor) { %>
          <div class="col-sm-3">
            <div class="thumbnail">
              <a href="/item/<%= item.itemNumber %>" class="thumbnail-link">
                <div class="image-wrapper">
                  <img src="<%= item.imageUrl || '/images/default-image.jpg' %>" alt="<%= item.name %>" class="item-image">
                </div>
              </a>
              <div class="caption">
                <h3 class="item-title"><%= item.name %></h3>
                <p class="item-price"><%= item.price === 0 ? 'FREE' : '$' + item.price %></p>
                <div class="content-actions">
                  <a href="/pages/userPage/EditCreation?itemNumber=<%= item.itemNumber %>" class="btn btn-info" role="button">Edit</a>
                  <button class="btn btn-danger delete-btn" data-item-number="<%= item.itemNumber %>">Delete</button>
                </div>
              </div>

            </div>
          </div>
          <% if ((index + 1) % 4 === 0) { %>
            </div><div class="row content-viewer">
          <% } %>
        <% } %>
      <% }); %>
    </div>
  <% } else { %>
    <h4 class="text-center">No published items yet.</h4>
  <% } %>
</section>

<!-- Unpublished Content Section -->
<section class="content-section">
  <h2 class="text-center">Unpublished Content</h2>
  <% if (authorName && unpublishedItems && unpublishedItems.length > 0) { %>
    <div class="row content-viewer">
      <% unpublishedItems.forEach((item, index) => { %>
        <% if (item.ownedByAuthor) { %>
          <div class="col-sm-3">
            <div class="thumbnail">
              <a href="/item/<%= item.itemNumber %>" class="thumbnail-link">
                <div class="image-wrapper">
                  <img src="<%= item.imageUrl || '/images/default-image.jpg' %>" alt="<%= item.name %>" class="item-image">
                </div>
              </a>
              <div class="caption">
                <h3 class="item-title"><%= item.name %></h3>
                <p class="item-price"><%= item.price === 0 ? 'FREE' : '$' + item.price %></p>
                <div class="content-actions">
                  <a href="/pages/userPage/EditCreation?itemNumber=<%= item.itemNumber %>" class="btn btn-info" role="button">Edit</a>
                  <button class="btn btn-danger delete-btn" data-item-number="<%= item.itemNumber %>">Delete</button>
                </div>
              </div>
            </div>
          </div>
          <% if ((index + 1) % 4 === 0) { %>
            </div><div class="row content-viewer">
          <% } %>
        <% } %>
      <% }); %>
    </div>
  <% } else { %>
    <h4 class="text-center">No unpublished items yet.</h4>
  <% } %>
</section>


  </div>


  <div class="nav-spacer"></div>
  <%- include('../../footer.ejs') %>


  <!-- Bootstrap core JavaScript
    ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
  <script src="/js/bootstrap.min.js"></script>
  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>
</body>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const editBtn = document.getElementById('editBtn');
    const submitBtn = document.getElementById('submitBtn');
    const authorNameInput = document.getElementById('authorName');

    editBtn.addEventListener('click', function() {
      authorNameInput.removeAttribute('readonly');
      editBtn.style.display = 'none';
      submitBtn.style.display = 'inline-block';
    });

  });

  document.addEventListener('DOMContentLoaded', function() {
    const closeBtn = document.querySelector('#alertMsg .close');

    if (closeBtn) {
      closeBtn.addEventListener('click', function() {
        const alertMsg = document.getElementById('alertMsg');
        alertMsg.style.display = 'none';
      });
    }
  });

  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.delete-btn').forEach(button => {
      button.addEventListener('click', function(event) {
        const itemNumber = event.target.getAttribute('data-item-number');
        const confirmation = confirm('Are you sure you want to delete this item?');

        if (confirmation) {
          // Redirect to delete item route
          window.location.href = `/deleteItem?itemNumber=${itemNumber}`;
        }
      });
    });
  });
  
  
</script>


</html>